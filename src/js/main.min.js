"use strict";

window.onload = ()=>{
    AttachEvents();
};

function AttachEvents() {
    document.querySelectorAll("div.vplayable").forEach(element => {
        if (!element.classList.contains("lex-elistener-attached"))
        {
            const video = element.children[0];
            const audio = element.children[1];
            const ctrls = element.children[2];

            const button = ctrls.children[0];
            const slider = ctrls.children[1];
            const volume = ctrls.children[2];

            video.addEventListener("click", ()=>{
                video.paused ? (video.play(), audio.play()) : (video.pause(), audio.pause());
                slider.max = video.duration;
                audio.volume = volume.value;
            });

            video.addEventListener("timeupdate", ()=>{
                slider.value = video.currentTime;
            });

            button.addEventListener("click", ()=>{
                video.paused ? (video.play(), audio.play()) : (video.pause(), audio.pause());
                slider.max = video.duration;
                audio.volume = volume.value;
            });

            slider.addEventListener("input", ()=>{
                video.paused ? void(null) : (video.pause(), audio.pause());

                video.currentTime = slider.value;
                audio.currentTime = slider.value;
            });

            volume.addEventListener("input", ()=>{
                audio.volume = volume.value;
            });

            element.classList.add("lex-elistener-attached");
        }
    });
}

function loadPosts(e) {
    document.getElementById("LoadMorePosts").remove();
    fetch(`${window.location.href.split("?")[0]}/loadPosts?after=${e}`)
    .then(e=>e.text())
    .then(e=>{document.getElementById("posts").insertAdjacentHTML("beforeend", e);})
    .then(()=>(AttachEvents()));
}
